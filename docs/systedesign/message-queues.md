# Message Queues (–û—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π)

Message Queue ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã. –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ—Ä–≤–∏—Å–∞–º –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –±–µ–∑ –ø—Ä—è–º–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.

---

## üîπ –ó–∞—á–µ–º –Ω—É–∂–Ω—ã Message Queues?

### –ü—Ä–æ–±–ª–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

* **–°–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤**: –ø–∞–¥–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥–∏–µ
* **–ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –Ω—É–∂–Ω–æ –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞ –æ—Ç –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
* **–ü–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞**: —Å–µ—Ä–≤–∏—Å –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –≤–Ω–µ–∑–∞–ø–Ω—ã–º –≤—Å–ø–ª–µ—Å–∫–æ–º –∑–∞–ø—Ä–æ—Å–æ–≤
* **–ù–µ—Ç –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏**: –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Message Queues

* **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
* **–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è**: —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏
* **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –≤–æ—Ä–∫–µ—Ä–æ–≤
* **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å**: –≥–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏, retry –º–µ—Ö–∞–Ω–∏–∑–º—ã
* **–†–∞–∑–≤—è–∑–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤**: —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–Ω–∞—é—Ç –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ –Ω–∞–ø—Ä—è–º—É—é

---

## üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### Producer (–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å)

–°–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å.

```python
import pika

connection = pika.BlockingConnection(pika.ConnectionParameters('localhost'))
channel = connection.channel()

channel.queue_declare(queue='orders')

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
channel.basic_publish(
    exchange='',
    routing_key='orders',
    body='{"order_id": 123, "user_id": 456}'
)
```

### Consumer (–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å)

–°–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –æ—á–µ—Ä–µ–¥–∏.

```python
def process_order(ch, method, properties, body):
    order_data = json.loads(body)
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–∞
    print(f"Processing order {order_data['order_id']}")
    ch.basic_ack(delivery_tag=method.delivery_tag)

channel.basic_consume(
    queue='orders',
    on_message_callback=process_order
)
channel.start_consuming()
```

### Queue (–û—á–µ—Ä–µ–¥—å)

–ë—É—Ñ–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

### Exchange (–û–±–º–µ–Ω–Ω–∏–∫)

–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –Ω—É–∂–Ω—ã–µ –æ—á–µ—Ä–µ–¥–∏ (–≤ RabbitMQ).

---

## üîπ –¢–∏–ø—ã –æ—á–µ—Ä–µ–¥–µ–π

### 1. Point-to-Point (–û–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É)

–û–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ–¥–Ω–∏–º –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–º.

```
Producer ‚Üí Queue ‚Üí Consumer 1
                  ‚Üí Consumer 2 (–Ω–µ –ø–æ–ª—É—á–∏—Ç —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
```

**–ü—Ä–∏–º–µ—Ä—ã**: RabbitMQ, Amazon SQS, ActiveMQ

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ó–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑

### 2. Pub/Sub (Publish-Subscribe)

–û–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—é—Ç –≤—Å–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–∏.

```
Producer ‚Üí Exchange ‚Üí Queue 1 ‚Üí Consumer 1
                  ‚Üí Queue 2 ‚Üí Consumer 2
                  ‚Üí Queue 3 ‚Üí Consumer 3
```

**–ü—Ä–∏–º–µ—Ä—ã**: Apache Kafka, Redis Pub/Sub, RabbitMQ (fanout exchange)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —Å–æ–±—ã—Ç–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üîπ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ Message Queues

### 1. RabbitMQ

**–¢–∏–ø**: Message Broker

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
* –ì–∏–±–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (exchanges, routing keys)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ (AMQP, MQTT, STOMP)
* –ì–∞—Ä–∞–Ω—Ç–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏
* –£–ø—Ä–∞–≤–ª—è–µ–º—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
* –°–ª–æ–∂–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
* –ù—É–∂–Ω—ã –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
* –°—Ä–µ–¥–Ω–∏–π –æ–±—ä—ë–º —Å–æ–æ–±—â–µ–Ω–∏–π

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```python
# Producer
channel.basic_publish(
    exchange='orders',
    routing_key='payment',
    body=json.dumps(order_data),
    properties=pika.BasicProperties(delivery_mode=2)  # Persistent
)

# Consumer
channel.basic_consume(
    queue='payment_queue',
    on_message_callback=process_payment
)
```

### 2. Apache Kafka

**–¢–∏–ø**: Distributed Event Streaming Platform

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
* –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (–º–∏–ª–ª–∏–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫)
* –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π (–ª–æ–≥–∏)
* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
* Replay —Å–æ–æ–±—â–µ–Ω–∏–π

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
* –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞
* –ù—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
* Event streaming, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
* Real-time data pipelines

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```python
from kafka import KafkaProducer, KafkaConsumer

# Producer
producer = KafkaProducer(bootstrap_servers=['localhost:9092'])
producer.send('orders', value=json.dumps(order_data).encode())

# Consumer
consumer = KafkaConsumer('orders', bootstrap_servers=['localhost:9092'])
for message in consumer:
    process_order(json.loads(message.value))
```

### 3. Amazon SQS

**–¢–∏–ø**: Managed Message Queue (AWS)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
* –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π —Å–µ—Ä–≤–∏—Å
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ AWS —Å–µ—Ä–≤–∏—Å–∞–º–∏
* –î–≤–∞ —Ç–∏–ø–∞: Standard –∏ FIFO

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ AWS
* –ù–µ —Ö–æ—Ç–∏—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
* –ù—É–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Lambda, S3 –∏ —Ç.–¥.

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```python
import boto3

sqs = boto3.client('sqs')
queue_url = 'https://sqs.us-east-1.amazonaws.com/123456789/orders'

# –û—Ç–ø—Ä–∞–≤–∫–∞
sqs.send_message(
    QueueUrl=queue_url,
    MessageBody=json.dumps(order_data)
)

# –ü–æ–ª—É—á–µ–Ω–∏–µ
response = sqs.receive_message(QueueUrl=queue_url)
messages = response.get('Messages', [])
```

### 4. Redis (Pub/Sub, Lists)

**–¢–∏–ø**: In-Memory Data Store (–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –æ—á–µ—Ä–µ–¥—å)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
* –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ (<1 –º—Å)
* –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (Lists, Pub/Sub)
* –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π –¥–æ—Å—Ç–∞–≤–∫–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
* –ù–∏–∑–∫–∞—è latency –∫—Ä–∏—Ç–∏—á–Ω–∞
* –ú–æ–∂–Ω–æ –¥–æ–ø—É—Å—Ç–∏—Ç—å –ø–æ—Ç–µ—Ä—é –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
* –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
```python
import redis

r = redis.Redis(host='localhost', port=6379)

# Producer (–∏—Å–ø–æ–ª—å–∑—É—è Lists)
r.lpush('orders', json.dumps(order_data))

# Consumer
while True:
    message = r.brpop('orders', timeout=1)
    if message:
        process_order(json.loads(message[1]))
```

---

## üîπ –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. Task Queue (–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á)

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—è–∂—ë–ª—ã—Ö –∑–∞–¥–∞—á.

**–ü—Ä–∏–º–µ—Ä**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –æ—Ç–ø—Ä–∞–≤–∫–∞ email, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤

```python
# Producer
def upload_image(image_data):
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    image_id = save_image(image_data)
    # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
    queue.enqueue('process_image', image_id)
    return {'status': 'uploaded', 'image_id': image_id}

# Consumer (Worker)
@worker.task
def process_image(image_id):
    # –†–µ—Å–∞–π–∑, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
    resize_image(image_id)
    generate_thumbnails(image_id)
    # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    send_notification(image_id)
```

### 2. Event-Driven Architecture

–°–µ—Ä–≤–∏—Å—ã –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è–º–∏ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å.

**–ü—Ä–∏–º–µ—Ä**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ ‚Üí —Å–æ–±—ã—Ç–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```python
# Order Service (Producer)
def create_order(order_data):
    order = save_order(order_data)
    
    # –ü—É–±–ª–∏–∫—É–µ–º —Å–æ–±—ã—Ç–∏—è
    event_bus.publish('order.created', {
        'order_id': order.id,
        'user_id': order.user_id,
        'total': order.total
    })
    return order

# Payment Service (Consumer)
@event_bus.subscribe('order.created')
def process_payment(event):
    charge_user(event['user_id'], event['total'])

# Notification Service (Consumer)
@event_bus.subscribe('order.created')
def send_confirmation(event):
    send_email(event['user_id'], f"Order {event['order_id']} created")
```

### 3. Request-Reply Pattern

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å.

```python
# Client (Request)
request_id = str(uuid.uuid4())
queue.publish('requests', {
    'request_id': request_id,
    'action': 'get_user',
    'user_id': 123
})

# –ñ–¥—ë–º –æ—Ç–≤–µ—Ç
response = wait_for_response(request_id, timeout=5)

# Server (Reply)
@queue.subscribe('requests')
def handle_request(message):
    result = process_request(message)
    queue.publish('responses', {
        'request_id': message['request_id'],
        'result': result
    })
```

### 4. Message Buffer (–ë—É—Ñ–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π)

–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ.

**–ü—Ä–∏–º–µ—Ä**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–µ—Ç—Ä–∏–∫–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

```python
# Producer (–≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)
def log_event(event):
    # –ë—ã—Å—Ç—Ä–æ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
    queue.publish('logs', event)
    # –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫

# Consumer (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–∞—Ç—á–∞–º–∏)
@queue.subscribe('logs', batch_size=100)
def process_logs(events):
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–∞—Ç—á
    db.bulk_insert('logs', events)
```

---

## üîπ –ì–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏

### At-Most-Once (–ú–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω —Ä–∞–∑)

–°–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ—Ç–µ—Ä—è–Ω–æ, –Ω–æ –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –¥–≤–∞–∂–¥—ã.

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏)

### At-Least-Once (–ú–∏–Ω–∏–º—É–º –æ–¥–∏–Ω —Ä–∞–∑)

–°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ä–∞–∑ (–≤–æ–∑–º–æ–∂–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã).

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∑–∞–∫–∞–∑—ã, –ø–ª–∞—Ç–µ–∂–∏)

**–†–µ—à–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤**: –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π

```python
def process_order(order_id):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ª–∏ —É–∂–µ
    if db.order_processed(order_id):
        return  # –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
    db.mark_order_processed(order_id)
    process_payment(order_id)
```

### Exactly-Once (–†–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑)

–°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ (—Å–ª–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å).

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–∑-–∑–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏)

---

## üîπ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Retry (–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞)

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–≤—Ç–æ—Ä –ø—Ä–∏ –æ—à–∏–±–∫–µ.

```python
@queue.subscribe('orders', retry=3, retry_delay=5)
def process_order(message):
    try:
        # –û–±—Ä–∞–±–æ—Ç–∫–∞
        process_payment(message)
    except PaymentError:
        # –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ (–¥–æ 3 —Ä–∞–∑)
        raise RetryException()
```

### Dead Letter Queue (DLQ)

–°–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å, –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ DLQ.

```python
# –ü–æ—Å–ª–µ N –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
if retry_count >= max_retries:
    queue.publish('dead_letter_queue', message)
    # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∂–µ
```

### Exponential Backoff

–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏.

```python
retry_delay = min(2 ** retry_count, 300)  # 1s, 2s, 4s, 8s... –¥–æ 300s
```

---

## üîπ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–µ–π

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

* **Queue Length** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏
* **Processing Rate** ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –≤ —Å–µ–∫—É–Ω–¥—É
* **Error Rate** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫
* **Latency** ‚Äî –≤—Ä–µ–º—è –æ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏
* **Consumer Lag** ‚Äî –æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π (–¥–ª—è Kafka)

### –ê–ª–µ—Ä—Ç—ã

* Queue length > 1000 ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
* Error rate > 5% ‚Üí –∫—Ä–∏—Ç–∏—á–Ω–æ
* Consumer lag > 1 –º–∏–Ω—É—Ç–∞ ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ

---

## üîπ Best Practices

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ª–æ–º–∞—Ç—å —Å–∏—Å—Ç–µ–º—É
2. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ TTL**: —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –¥–æ–ª–∂–Ω—ã –≤–∏—Å–µ—Ç—å –≤–µ—á–Ω–æ
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –¥–ª–∏–Ω—É –æ—á–µ—Ä–µ–¥–∏**: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Dead Letter Queue**: –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
5. **–ë–∞—Ç—á–∏–Ω–≥**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–∞—Ç—á–∞–º–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
6. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è**: –≤–∞–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏
7. **Graceful shutdown**: –¥–∞–π—Ç–µ –≤–æ—Ä–∫–µ—Ä–∞–º –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã

* [–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ](./scaling.md) ‚Äî –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏
* [CAP —Ç–µ–æ—Ä–µ–º–∞ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å](./cap-theorem.md) ‚Äî eventual consistency –≤ –æ—á–µ—Ä–µ–¥—è—Ö
* [–û—Ü–µ–Ω–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ —Ä–µ—Å—É—Ä—Å–æ–≤](./load-estimation.md) ‚Äî —Ä–∞—Å—á—ë—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –æ—á–µ—Ä–µ–¥–∏

