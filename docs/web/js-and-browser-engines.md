# JS-движки и браузерные движки

Разобраться, **кто именно выполняет JavaScript** и **кто рисует страницу**, важно для понимания производительности, ограничений и возможностей веб-приложений.

---

## JS-движок (JavaScript Engine)

**JS-движок** — это часть платформы, которая **парсит, компилирует и выполняет JavaScript-код**.

Примеры JS-движков:

- **V8** — Chrome, Edge, Node.js, Deno
- **SpiderMonkey** — Firefox
- **JavaScriptCore** (Nitro) — Safari

Основные задачи JS-движка:

1. **Парсинг и компиляция**:
   - Разбор JS-кода в AST (абстрактное синтаксическое дерево)
   - Компиляция в байткод или машинный код (JIT-компиляция)
2. **Выполнение кода**:
   - Управление **стеком вызовов (Call Stack)**
   - Работа с **контекстами выполнения** и **областью видимости**
3. **Управление памятью**:
   - Выделение/освобождение памяти
   - **Сборщик мусора (Garbage Collector)**
4. **Оптимизации**:
   - Inline функций
   - Удаление «мёртвого» кода
   - Специализация под конкретные типы данных

Важно: **JS-движок сам по себе не знает про DOM, сеть, таймеры и т.п.**  
Все эти возможности приходят из окружения (браузер, Node.js и др.).

---

## Браузерный движок (Browser Engine)

**Браузерный движок** отвечает за:

- Загрузку HTML/CSS/ресурсов
- Построение DOM и CSSOM
- **Layout** (вычисление размеров и положения элементов)
- **Rendering / Painting** (отрисовка на экране)
- Обновление интерфейса при изменениях

Примеры браузерных движков:

- **Blink** — Chrome, Edge, Opera
- **WebKit** — Safari
- **Gecko** — Firefox

Браузерный движок:

1. Разбирает HTML → строит **DOM-дерево**
2. Разбирает CSS → строит **CSSOM**
3. Объединяет DOM + CSSOM → **Render Tree**
4. Выполняет **layout** → вычисляет размеры и позиционирование
5. Выполняет **paint/compositing** → рисует результат на экране

---

## Как они работают вместе

В браузере **JS-движок встроен внутрь браузерного движка**:

- Браузерный движок:
  - Загружает HTML/CSS/JS
  - Строит DOM/CSSOM
  - Предоставляет JS-коду Web API (DOM, `fetch`, `setTimeout`, `addEventListener`, и т.д.)
- JS-движок:
  - Выполняет JS-код
  - Вызывает функции Web API (которые реализованы в браузерном движке)

Типичный цикл:

1. JS-код вызывает, например, `button.addEventListener('click', handler)`
2. Браузерный движок регистрирует обработчик на уровне системы событий
3. При клике браузерный движок создаёт событие и ставит задачу в очередь
4. Event Loop передаёт управление JS-движку
5. JS-движок выполняет `handler`, который может изменить DOM
6. Браузерный движок видит изменения → пересчитывает layout + перерисовывает страницу

Подробнее про Event Loop см. **[Event Loop в JavaScript](../javascript/event-loop.md)**.

---

## Главное отличие

Кратко:

- **JS-движок**:
  - Выполняет JS-код
  - Управляет памятью и оптимизациями
  - Не знает сам по себе про DOM/рендеринг
- **Браузерный движок**:
  - Отвечает за разбор HTML/CSS
  - Строит DOM/CSSOM/Render Tree
  - Выполняет layout/paint
  - Предоставляет Web API для JS

Можно думать так:

> **JS-движок — это «мозг», который выполняет код.  
> Браузерный движок — это «тело», которое рисует и взаимодействует с внешним миром.**

---

## JS-движки вне браузера

JS-движок может существовать **без браузерного движка**:

- **Node.js / Deno**:
  - Используют V8
  - Нет DOM, `window`, `document`
  - Вместо этого есть API операционной системы: файловая система, сеть, процессы

То есть:

- В браузере: **Browser Engine + JS Engine**
- В Node.js: **JS Engine + Node API**, но **без Browser Engine**

